# 多组分液滴自发点火数值框架（无化学源项版本）

目标：给第二代代码定一套干净的「控制方程 + 残差形式」。本版本完全不考虑化学反应源项，后续用 Strang 拆分在外层补化学。

---

## 1. 模型假设与坐标系

1. **几何与坐标**

- 1D 球对称，径向坐标 r。
- 液滴中心在 r = 0，液滴半径为 R_d(t)。
- 液相区域：0 ≤ r ≤ R_d(t)。
- 气相区域：R_d(t) ≤ r ≤ R_∞（R_∞ 取足够大，近似无限远）。

2. **方向与法向约定**

- 单位法向 n = e_r，由液相指向气相（从小 r 指向大 r）。
- 所有界面通量（质量通量 m''、扩散通量 J、热通量 q）的正方向均定义为沿 +n（从液滴指向外界）。

3. **低马赫数 / 无动量方程**

- 不显式求解动量方程，不把速度作为未知量。
- 在气相中只使用**相对界面速度** v_rel(r, t)，定义为
  v_rel(r, t) ≡ v_r(r, t) - dR_d/dt（沿 +n 方向为正），
  由质量守恒 / Stefan 流表达式计算，作为派生量，仅用于对流通量和界面条件；
  实现中不显式存绝对速度 v_r。

4. **多组分液滴 & 无凝结**

- 液相可以包含多个可挥发组分（“凝相物种集合” L）。前期可退化为单组分液滴测试。
- 气相不发生冷凝，仅有「液滴 → 气相」的蒸发质量传递（无「气相 → 液相」凝结）。

5. **本版本统一约定**

- 不考虑任何体积源项（化学反应、辐射等全部不在本版本）。
- 所有控制方程与残差中不出现化学源项，后续用 Strang 拆分在外层补化学。

---

## 2. 变量与未知量定义（输运步）

在输运时间步（隐式离散）中，未知量向量 U 仅包含温度、质量分数以及界面量，不包含速度。

### 2.1 气相未知量

- 气相温度：
  - T_g[i], i = 1..N_g
- 气相物种质量分数（有效分量）：
  - Y_g[k, i], k = 1..N_g_eff, i = 1..N_g
  - N_g_eff = N_g_spec - 1，少一个用 ΣY_g = 1 约束。
  - 或者保留全部 N_g_spec 个分量，再额外加一条 ΣY_g - 1 = 0 约束残差（二选一实现）。

- 气相密度 ρ_g(T_g, Y_g) 由状态方程计算，不作为独立未知量。

### 2.2 液相未知量

- 液相温度：
  - T_l[j], j = 1..N_l
- 液相物种质量分数（多组分液滴时）：
  - Y_l[m, j], m = 1..N_l_eff, j = 1..N_l
  - 单组分液滴测试阶段可暂不引入 Y_l。

- 液相密度 ρ_l(T_l, Y_l) 由物性模块计算，不作为独立未知量。

### 2.3 界面与几何未知量

- 界面温度：
  - T_s ≡ T(r = R_d)
- 界面总质量通量（蒸发通量）：
  - m''  [kg m^-2 s^-1]
- 液滴半径：
  - R_d

因此，输运步整体未知向量 U 可表示为：

U = [ {T_g}, {Y_g}, {T_l}, {Y_l}, T_s, m'', R_d ]^T

（单组分液滴阶段可省略 Y_l 相关块。）

---

## 3. 连续方程与速度表达式（Stefan 流）

### 3.1 气相质量连续方程（概念）

在气相区域，忽略体积源项与压缩性效应，在球对称下，我们只使用
**相对界面速度** v_rel(r, t)，定义为

v_rel(r, t) ≡ v_r(r, t) - dR_d/dt

其中 v_r 为气相质量平均速度在径向上的分量，dR_d/dt 为液滴界面移动速度（向外为正）。

在该定义下，气相质量连续方程写成：

∂ρ_g/∂t + 1/r^2 ∂(ρ_g v_rel r^2)/∂r = 0

界面处，质量源为蒸发通量 m''：

lim_{ε→0+} [ρ_g v_rel r^2]_{r=R_d+ε} = m'' R_d^2

在常用的「准稳态质量流」假设下：

ρ_g v_rel r^2 = m'' R_d^2

⇒ v_rel(r) = m'' R_d^2 / (ρ_g(r) r^2)

结论：速度场 v_rel(r) 由 ρ_g(r)、m'' 和 R_d 决定，不作为独立未知量，在离散时仅用于构建对流通量和界面 Stefan 条件。

---

## 4. 气相控制方程（无化学源项）

### 4.1 气相物种方程（对每个物种）

对气相物种 k：

- 质量分数：Y_g,k(r, t)
- 扩散通量 J_g,k(r, t) 沿 n = e_r 的分量正方向从液滴指向外界。

物种守恒方程（无源项）：

ρ_g ∂Y_g,k/∂t + 1/r^2 ∂[ρ_g v_rel Y_g,k r^2]/∂r = - 1/r^2 ∂[J_g,k r^2]/∂r

说明：

- 左侧第二项为 Stefan 流（相对界面速度 v_rel）贡献的对流通量散度；
- 右侧为扩散通量散度，J_g,k 的具体形式交由传输模块处理（Fick 或多组分扩散）。

### 4.2 气相能量方程（总焓形式）

以混合物焓 h_g(T_g, Y_g) 作为变量：

ρ_g ∂h_g/∂t + 1/r^2 ∂[ρ_g v_rel h_g r^2]/∂r = - 1/r^2 ∂[q_g r^2]/∂r + Φ_diff-h

其中：

- 热通量：
  - q_g = - λ_g ∂T_g/∂r
  - 正方向为沿 +r（从液滴指向外界）
- Φ_diff-h 为物种扩散携带焓的源项（多组分精细处理时保留；初期可忽略）。

本版本中不含任何化学放热项（无 ω_k h_k）。

---

## 5. 液相控制方程（无化学源项）

### 5.1 液相物种方程（多组分液滴时）

对液相物种 m：

ρ_l ∂Y_l,m/∂t = - 1/r^2 ∂[J_l,m r^2]/∂r

说明：

- 液相内部不考虑宏观对流（默认静止液滴），仅有分子扩散；
- 单组分液滴阶段可不解该方程，仅保持液滴为纯燃料。

### 5.2 液相能量方程

以焓 h_l(T_l, Y_l) 表示：

ρ_l ∂h_l/∂t = - 1/r^2 ∂[q_l r^2]/∂r + Φ_diff-h,l

热通量：

- q_l = - λ_l ∂T_l/∂r
- 正方向沿 +r（从液滴内部指向界面）

同样不含化学源项。

---

## 6. 界面条件（无凝结，多组分液滴，Cuoci 风格）

界面位置 r = R_d(t)。

### 6.1 温度连续

T_g(R_d^+, t) = T_l(R_d^-, t) = T_s(t)

### 6.2 物种通量条件（无凝结）

法向 n = e_r 向外（从液滴指向气相）。

**对凝相物种 i ∈ L（液滴中存在的可挥发组分）：**

- 液相侧：

  J_l,i · n = + m'' Y_l,i,s

- 气相侧（Stefan 条件，使用相对界面速度 v_rel,s）：

  令 v_rel,s ≡ v_s - dR_d/dt 为界面处气相速度相对于界面的法向分量，则

  J_g,i · n + ρ_g,s Y_g,i,s v_rel,s = m'' Y_l,i,s

其中：

- Y_l,i,s 为液相界面质量分数；
- Y_g,i,s 为气相界面质量分数，由界面热力学平衡（如 Raoult + psat）给出；
- ρ_g,s 为界面气相密度；
- v_rel,s 为界面处气相**相对界面**的速度（沿 n）。

**对非凝相物种 j ∉ L：**

非凝相气体不从液滴获得质量源，仅有对流与扩散穿越界面，其总通量为零：

J_g,j · n + ρ_g,s Y_g,j,s v_rel,s = 0

> 实现中通常选一个主凝相物种（例如主燃料）用于求 m''，其余物种通量通过界面平衡与总质量守恒回算。

### 6.3 总质量守恒（界面）

气相扩散通量 J_g,k 按质量平均速度为参考系定义，因此在界面上满足**扩散通量零和**：

Σ_k J_g,k · n = 0

界面穿越的总质量通量由 Stefan 流给出：

m'' = ρ_g,s v_rel,s

其中 v_rel,s 为界面处气相相对界面的速度（见 §3.1），ρ_g,s 为界面气相密度。

在数值实现中，一般不再单独给出“Σ_k J_g,k · n + m'' = 0”这样混合总通量的方程，而是：

- 用某个主凝相物种的 Stefan 关系（见 §6.2、§8.2）定义 m''；
- 在构造扩散通量 J_g,k 时保持 Σ_k J_g,k · n = 0，从而保证 Σ_k Y_g,k = 1 的闭合性。

### 6.4 能量跳跃条件（蒸发潜热，无凝结）

界面能量守恒（忽略凝结、界面储能等）：

q_l · n - q_g · n + Σ_k h_k,g J_g,k · n = m'' h_vap

其中：

- 左侧为：液相导出热量减去气相导回热量，加上物种扩散携带的焓；
- 右侧为蒸发潜热需求；
- h_vap 为燃料蒸发潜热（可近似为界面处气相燃料焓与液相燃料焓之差）。

该式定义界面能量残差 R_energy_if(T_s, m'', …) = 0。

---

## 7. 液滴整体质量守恒与半径演化

液滴总质量近似为：

M_l(t) ≈ (4/3) π R_d^3(t) · ρ̄_l(t)

其中 ρ̄_l 为液滴平均密度。

整体质量守恒：

dM_l/dt = - 4 π R_d^2 m''

代入 M_l 得：

d/dt [ (4/3) π R_d^3 ρ̄_l ] = - 4 π R_d^2 m''

用后向 Euler 离散（时间步长 Δt）：

[ρ̄_l^{n+1} R_d^{n+1,3} - ρ̄_l^n R_d^{n,3}] / Δt = - 3 m''^{n+1} R_d^{*2}

其中 R_d^* 可为 R_d^{n+1} 或时间平均值。

对应半径残差：

R_Rd = ρ̄_l^{n+1} R_d^{n+1,3} - ρ̄_l^n R_d^{n,3} + 3 Δt m''^{n+1} R_d^{*2} = 0

---

## 8. 空间离散与残差形式（无源项）

以下为统一的有限体积残差定义，适配 Python + petsc4py 构建线性系统。

### 8.1 通量与残差通用格式

对任意标量 φ（如 Y_g,k, Y_l,m, h_g, h_l 或 T），在第 i 个控制体（CV）定义残差：

R_φ,i = [ (ρ φ V)_i^{n+1} - (ρ φ V)_i^n ] / Δt + Σ_{f∈∂V_i} F_φ,f^(out) = 0

其中：

- V_i 为 CV 体积；
- 对每个面 f，F_φ,f^(out) 定义为「从 CV 内流出到外部」的通量（正号）。

具体通量：

- 物种对流通量：

  F_Y,k,f^(conv,out) = (ρ v_n Y_k)_f A_f

- 物种扩散通量：

  F_Y,k,f^(diff,out) = (J_k · n_f)_f A_f

- 热传导通量（焓/温度）：

  F_T,f^(cond,out) = (q · n_f)_f A_f = [ - λ (∂T/∂r)_f ] A_f · sign

关键约定：

- 对内部面，同一物理面在左右两个 CV 中的通量大小相等、符号相反，保证整体守恒。
- 界面处通量由界面条件（Stefan + 能量跳跃）决定，并通过独立界面残差保证“两侧一致”。

### 8.2 气相物种残差（示意）

对气相第 i 个 CV、物种 k：

R_Yg,i,k = [ (ρ_g Y_g,k V)_i^{n+1} - (ρ_g Y_g,k V)_i^n ] / Δt
          + Σ_f [ F_Yg,k,f^(conv,out) + F_Yg,k,f^(diff,out) ] = 0

- 内部面：通量由相邻 cell 的 Y_g 与 Stefan 速度 v_rel 插值。
- 靠近界面那一层的气相 cell，其界面侧通量由界面条件提供的 J_g,k 与 v_rel,s 构造（见 §6.2）。

### 8.3 气相能量残差（示意）

写成焓形式，对第 i 个气相 CV：

R_hg,i = [ (ρ_g h_g V)_i^{n+1} - (ρ_g h_g V)_i^n ] / Δt
         + Σ_f [ F_hg,f^(conv,out) + F_hg,f^(cond,out) + F_hg,f^(diff-h,out) ] = 0

其中：

- F_hg,f^(conv,out) = (ρ_g v_rel,n h_g)_f A_f，其中 v_rel,n 为相对界面速度在 n_f 方向上的分量
  （在本 1D 球对称框架中，v_rel,n = v_rel）。
- F_hg,f^(cond,out) = (q_g · n_f)_f A_f
- F_hg,f^(diff-h,out) 为扩散焓通量（可选）

### 8.4 液相残差（示意）

- 液相物种：

  R_Yl,j,m = [ (ρ_l Y_l,m V)_j^{n+1} - (ρ_l Y_l,m V)_j^n ] / Δt
             + Σ_f F_Yl,m,f^(diff,out) = 0

- 液相能量：

  R_hl,j = [ (ρ_l h_l V)_j^{n+1} - (ρ_l h_l V)_j^n ] / Δt
           + Σ_f [ F_hl,f^(cond,out) + F_hl,f^(diff-h,out) ] = 0

液滴中心 r=0 使用对称边界条件（中心面通量为 0）。

### 8.5 界面与半径残差小结

最终需要额外的界面/几何残差：

1. 界面能量残差：
   - R_energy_if = q_l · n - q_g · n + Σ_k h_k,g J_g,k · n - m'' h_vap = 0

2. 界面质量残差：

   实现中选定一个“主凝相物种” f（例如主燃料），用其界面物种平衡来定义 m''：

   - R_mass_if = J_g,f · n + ρ_g,s Y_g,f,s v_rel,s - m'' Y_l,f,s = 0

   其中：

   - ρ_g,s、Y_g,f,s 为界面气相密度与该物种质量分数；
   - Y_l,f,s 为液相界面质量分数；
   - v_rel,s 为界面处气相相对界面的速度（见 §3.1、§6.2）。

   对非凝相物种 j ∉ L，有无净跨界质量通量约束：

   - J_g,j · n + ρ_g,s Y_g,j,s v_rel,s = 0

   这类约束一般通过对流 / 扩散通量的构造以及 Σ_k J_g,k · n = 0 的闭合自动满足，
   不单独写成额外的残差方程。

3. 液滴半径残差：
   - R_Rd = ρ̄_l^{n+1} R_d^{n+1,3} - ρ̄_l^n R_d^{n,3} + 3 Δt m''^{n+1} R_d^{*2} = 0

4. （可选）界面温度连续残差：
   - R_Ts = T_s - T_g,interp(R_d) = 0（若不采用 ghost cell 的方式）

---

本框架仅描述「无化学源项」下的传输与界面控制方程及残差形式，可作为 Python + petsc4py 第二代代码的基础“宪法”，在此基础上可逐步叠加化学拆分、动网格与并行策略。

---

## 附录 A：实现 / 测试时的最小一致性检查（建议）

为了避免后续在实现或重构时破坏基本物理约束，建议在代码中（例如每个时间步或每次 Newton 迭代后）增加以下检查：

- 气相质量分数闭合：
  Σ_k Y_g,k = 1，且所有 Y_g,k ≥ 0。

- 界面处扩散通量零和：
  Σ_k J_g,k · n ≈ 0。

- 非凝相物种（j ∉ L）界面无净质量源：
  J_g,j · n + ρ_g,s Y_g,j,s v_rel,s ≈ 0。

- 界面能量守恒与界面温度残差一致：
  使用同一套方向 / 符号约定构建 R_energy_if(T_s, m'', …) 与（可选的）R_Ts，
  避免一边“往外为正”、另一边“往里为正”的混用。

上述检查仅作为数值实现的守门人：
一旦发现严重偏离（例如 Σ_k Y_g,k 明显不为 1，或 Σ_k J_g,k · n 显著不为 0），
应优先排查控制方程、接口符号与通量方向约定是否被破坏。
